<!DOCTYPE html>
{% load i18n %} {% load custom_filters %}
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}{% trans "Astrology Platform" %}{% endblock %}
    </title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />

    <!-- PWA Manifest & Meta -->
    <link rel="manifest" href="{% static 'manifest.json' %}" />
    <meta name="theme-color" content="#dc3545" />
  </head>

  <body>
    <header>
      <nav
        class="navbar navbar-expand-lg navbar-dark fixed-top sacred-nav"
      >
        <div class="container container-lg px-2 flex-nowrap">
          <!-- Hamburger (mobile only) -->
          <button
            class="navbar-toggler d-lg-none me-2 header-icon-btn p-0"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#mobileNav"
          >
            <i class="bi bi-list fs-4"></i>
          </button>

          <!-- Logo -->
          <a class="navbar-brand fw-bold mobile-center-logo" href="/">
          <img src="{% static 'img/logo.png' %}" alt="Logo" class="img-fluid" style="max-height: 40px;">
          </a>

          <!-- Desktop menu -->
          <div class="collapse navbar-collapse d-none d-lg-flex">
            <ul class="navbar-nav mx-auto gap-lg-3">
              <li class="nav-item">
                <a class="nav-link" href="/">{% trans "Home" %}</a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="{% url 'astrologers:astrologer_list' %}"
                >
                  {% trans "Talk with Astrologer" %}
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'astromall:pooja_list' %}"
                  >{% trans "Book a Pooja" %}</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'astromall:product_list' %}"
                  >{% trans "Astromall" %}</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'blog:blog_list' %}"
                  >{% trans "Blog" %}</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'kundali:kundali_form' %}"
                  >{% trans "Kundali" %}</a
                >
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="javascript:void(0)"
                  id="horoscopeDropdown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  {% trans "Horoscopes" %}
                </a>
                <ul class="dropdown-menu" aria-labelledby="horoscopeDropdown">
                  <li>
                    <a
                      class="dropdown-item"
                      href="{% url 'horoscope:horoscope_daily' day='today' %}"
                      >{% trans "Today" %}</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="{% url 'horoscope:horoscope_daily' day='tomorrow' %}"
                      >{% trans "Tomorrow" %}</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="{% url 'horoscope:horoscope_daily' day='yesterday' %}"
                      >{% trans "Yesterday" %}</a
                    >
                  </li>
                  <li>
                    <hr class="dropdown-divider" />
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="{% url 'horoscope:horoscope_weekly' %}"
                      >{% trans "Weekly" %}</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="{% url 'horoscope:horoscope_monthly' %}"
                      >{% trans "Monthly" %}</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="{% url 'horoscope:horoscope_yearly' %}"
                      >{% trans "Yearly" %}</a
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </div>

          <!-- Cart and Login -->
          <div
            class="ms-auto d-flex align-items-center gap-1 gap-lg-3"
          >
            {% if user.is_authenticated %}
            <div class="d-none d-lg-flex align-items-center me-3">
              <form
                action="{% url 'set_language' %}"
                method="post"
                class="d-flex align-items-center"
              >
                {% csrf_token %}
                <input
                  name="next"
                  type="hidden"
                  value="{{ request.get_full_path }}"
                />
                <select name="language" onchange="this.form.submit()"
                  class="form-select form-select-sm border-0 bg-light"
                  style="width: auto; cursor: pointer"
                >
                  {% get_current_language as CURRENT_LANG %} {% get_available_languages as LANGUAGES %} 
                  {% for lang in LANGUAGES %}
                  <option
                    value="{{ lang.0 }}"
                    {% if lang.0|are_equal:CURRENT_LANG %}selected{% endif %}
                    data-name="{{ lang.1 }}"
                    data-code="{{ lang.0|upper }}"
                  >
                    {{ lang.1 }}
                  </option>
                  {% endfor %}
                </select>
              </form>
            </div>

            <script>
              function updateLanguageLabels() {
                const isMobile = window.innerWidth < 992;
                document
                  .querySelectorAll('select[name="language"] option')
                  .forEach((opt) => {
                    if (opt.dataset.code && opt.dataset.name) {
                      opt.textContent = isMobile
                        ? opt.dataset.code
                        : opt.dataset.name;
                    }
                  });
              }
              window.addEventListener("resize", updateLanguageLabels);
              document.addEventListener(
                "DOMContentLoaded",
                updateLanguageLabels
              );
              updateLanguageLabels();
            </script>

            {% if user.profile and request.resolver_match.app_name == 'astrologers' or user.profile and request.resolver_match.app_name == 'consultations' %}
            <!-- Desktop Wallet Display -->
            <a
              href="{% url 'accounts:recharge_page' %}"
              class="btn btn-sm btn-outline-danger me-3 d-none d-lg-block rounded-pill fw-bold"
              style="white-space: nowrap"
            >
              <i class="bi bi-wallet2"></i> ‚Çπ 
              {{ user.profile.wallet_balance|floatformat:0 }}
            </a>
            <!-- Mobile Wallet Display (Icon + Balance) -->
            <a
              href="{% url 'accounts:recharge_page' %}"
              class="btn btn-light position-relative me-1 d-lg-none shadow-sm border-0 d-flex align-items-center justify-content-center gap-1"
              style="
                height: 42px;
                border-radius: 10px;
                background: #fff;
                padding-left: 8px;
                padding-right: 8px;
              "
            >
              <i class="bi bi-wallet2 text-danger fs-5"></i>
              <span class="text-dark fw-bold" style="font-size: 0.9rem">
                ‚Çπ {{ user.profile.wallet_balance|floatformat:0 }}</span
              >
            </a>
            {% endif %}

            {% if request.resolver_match.view_name != 'astrologers:astrologer_list' %}
            <a
              href="{% url 'astromall:view_cart' %}"
              class="btn position-relative me-1 me-lg-3 header-icon-btn"
            >
              <i class="bi bi-cart3"></i>
              {% if user.cart_items.count > 0 %}
              <span
                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger shadow-sm border border-2 border-white"
                style="font-size: 0.7rem; padding: 0.35em 0.65em"
              >
                {{ user.cart_items.count }}
              </span>
              {% endif %}
            </a>
            {% endif %}

            <div class="dropdown">
              <a
                class="btn header-icon-btn dropdown-toggle"
                href="javascript:void(0)"
                role="button"
                id="dropdownMenuLink"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-circle"></i>
              </a>

              <ul
                class="dropdown-menu dropdown-menu-end shadow-sm border-0"
                aria-labelledby="dropdownMenuLink"
              >
                {% if user.astrologer_profile %}
                <li>
                  <a
                    class="dropdown-item d-flex align-items-center gap-2"
                    href="{% url 'consultations:astrologer_dashboard' %}"
                    ><i class="bi bi-speedometer2"></i> 
                    {% trans "Astrologer Dashboard" %}</a
                  >
                </li>
                {% endif %}
                <li>
                  <a
                    class="dropdown-item d-flex align-items-center gap-2"
                    href="{% url 'accounts:profile' %}"
                    ><i class="bi bi-person-fill"></i> {% trans "Profile" %}</a
                  >
                </li>
                <li>
                  <hr class="dropdown-divider" />
                </li>
                <li>
                  <a
                    class="dropdown-item d-flex align-items-center gap-2 text-danger"
                    href="{% url 'accounts:logout' %}"
                    ><i class="bi bi-box-arrow-right"></i> {% trans "Logout"
                    %}</a
                  >
                </li>
              </ul>
            </div>
            {% else %}
            <a
              href="{% url 'accounts:login' %}"
              class="login-btn d-flex align-items-center gap-1 text-decoration-none"
            >
              <i class="bi bi-person-circle"></i> {% trans "Login" %}
            </a>
            {% endif %}
          </div>
        </div>
      </nav>

      <div
        class="offcanvas offcanvas-start d-lg-none"
        tabindex="-1"
        id="mobileNav"
      >
        <div class="offcanvas-header mobile-menu-header">
          <h5 class="offcanvas-title fw-bold">
            <i class="bi bi-list me-2"></i> {% trans "Menu" %}
          </h5>
          <button
            type="button"
            class="btn-close text-reset"
            data-bs-dismiss="offcanvas"
          ></button>
        </div>

        <div class="offcanvas-body p-0">
          <ul class="list-group list-group-flush">
            {% if user.is_authenticated and user.profile %}
            <li class="list-group-item p-0 border-0">
              <a
                href="{% url 'accounts:recharge_page' %}"
                class="wallet-card-mobile d-flex align-items-center justify-content-between text-decoration-none"
              >
                <div class="d-flex align-items-center gap-2">
                  <span
                    class="d-flex align-items-center justify-content-center bg-white rounded-circle shadow-sm"
                    style="width: 32px; height: 32px"
                  >
                    <i class="bi bi-wallet2 text-danger"></i>
                  </span>
                  <span class="fw-bold text-dark"
                    >{% trans "Wallet Balance" %}</span
                  >
                </div>
                <span class="fw-bold text-danger fs-5"
                  >‚Çπ {{ user.profile.wallet_balance|floatformat:0 }}</span
                >
              </a>
            </li>
            {% endif %}

            <li class="list-group-item">
              <a
                class="d-flex align-items-center justify-content-between text-decoration-none text-dark"
                data-bs-toggle="collapse"
                href="#mobileLanguageCollapse"
                role="button"
                aria-expanded="false"
                aria-controls="mobileLanguageCollapse"
              >
                <span
                  ><i class="bi bi-translate me-2"></i> {% trans "Language"
                  %}</span
                >
                <i class="bi bi-chevron-down"></i>
              </a>
              <div class="collapse mt-2" id="mobileLanguageCollapse">
                <ul class="list-group list-group-flush ps-3">
                  {% get_available_languages as LANGUAGES %}
                  {% get_current_language as CURRENT_LANG %}
                  {% for lang in LANGUAGES %}
                  <li class="list-group-item border-0 p-1">
                    <form action="{% url 'set_language' %}" method="post">
                      {% csrf_token %}
                      <input
                        name="next"
                        type="hidden"
                        value="{{ request.get_full_path }}"
                      />
                      <input
                        name="language"
                        type="hidden"
                        value="{{ lang.0 }}"
                      />
                      <button
                        type="submit"
                        class="btn btn-link text-decoration-none {% if lang.0|are_equal:CURRENT_LANG %}text-danger fw-bold{% else %}text-secondary{% endif %} p-0"
                      >
                        {{ lang.1 }}
                      </button>
                    </form>
                  </li>
                  {% endfor %}
                </ul>
              </div>
            </li>

            <li class="list-group-item">
              <a href="/" class="text-decoration-none text-dark"
                >{% trans "Home" %}</a
              >
            </li>
            <li class="list-group-item">
              <a
                href="{% url 'astrologers:astrologer_list' %}"
                class="text-decoration-none text-dark"
                >{% trans "Chat with Astrologer" %}</a
              >
            </li>
            <li class="list-group-item">
              <a
                href="{% url 'astromall:pooja_list' %}"
                class="text-decoration-none text-dark"
                >{% trans "Book a Pooja" %}</a
              >
            </li>
            <li class="list-group-item">
              <a
                href="{% url 'astromall:product_list' %}"
                class="text-decoration-none text-dark"
                >{% trans "Astromall" %}</a
              >
            </li>
            <li class="list-group-item">
              <a
                class="d-flex align-items-center justify-content-between text-decoration-none text-dark"
                data-bs-toggle="collapse"
                href="#mobileHoroscopeCollapse"
                role="button"
                aria-expanded="false"
                aria-controls="mobileHoroscopeCollapse"
              >
                {% trans "Horoscopes" %} <i class="bi bi-chevron-down"></i>
              </a>
              <div class="collapse mt-2" id="mobileHoroscopeCollapse">
                <ul class="list-group list-group-flush ps-3">
                  <li class="list-group-item border-0 p-1">
                    <a
                      href="{% url 'horoscope:horoscope_daily' day='today' %}"
                      class="text-decoration-none text-secondary"
                      >{% trans "Today" %}</a
                    >
                  </li>
                  <li class="list-group-item border-0 p-1">
                    <a
                      href="{% url 'horoscope:horoscope_daily' day='tomorrow' %}"
                      class="text-decoration-none text-secondary"
                      >{% trans "Tomorrow" %}</a
                    >
                  </li>
                  <li class="list-group-item border-0 p-1">
                    <a
                      href="{% url 'horoscope:horoscope_daily' day='yesterday' %}"
                      class="text-decoration-none text-secondary"
                      >{% trans "Yesterday" %}</a
                    >
                  </li>
                  <li class="list-group-item border-0 p-1">
                    <a
                      href="{% url 'horoscope:horoscope_weekly' %}"
                      class="text-decoration-none text-secondary"
                      >{% trans "Weekly" %}</a
                    >
                  </li>
                  <li class="list-group-item border-0 p-1">
                    <a
                      href="{% url 'horoscope:horoscope_monthly' %}"
                      class="text-decoration-none text-secondary"
                      >{% trans "Monthly" %}</a
                    >
                  </li>
                  <li class="list-group-item border-0 p-1">
                    <a
                      href="{% url 'horoscope:horoscope_yearly' %}"
                      class="text-decoration-none text-secondary"
                      >{% trans "Yearly" %}</a
                    >
                  </li>
                </ul>
              </div>
            </li>
            <li class="list-group-item">
              <a
                href="{% url 'blog:blog_list' %}"
                class="text-decoration-none text-dark"
                >{% trans "Blogs" %}</a
              >
            </li>
            {% if user.is_authenticated %} {% if user.astrologer_profile %}
            <li class="list-group-item">
              <a
                href="{% url 'consultations:astrologer_dashboard' %}"
                class="text-decoration-none text-dark"
                >{% trans "Astrologer Dashboard" %}</a
              >
            </li>
            {% endif %}
            <li class="list-group-item">
              <a
                href="{% url 'accounts:profile' %}"
                class="text-decoration-none text-dark"
                >{% trans "Profile" %}</a
              >
            </li>
            <li class="list-group-item">
              <a
                href="{% url 'accounts:logout' %}"
                class="text-decoration-none text-danger"
                >{% trans "Logout" %}</a
              >
            </li>
            {% else %}
            <li class="list-group-item">
              <a
                href="{% url 'accounts:login' %}"
                class="text-decoration-none text-dark"
                >{% trans "Login" %}</a
              >
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </header>

    <main>{% block content %} {% endblock %}</main>

    <footer>
      <div class="footer-grid">
        <div>
          <h4>{% trans "Astrology" %}</h4>
          <ul>
            <li>
              <a
                href="{% url 'kundali:kundali_form' %}"
                class="text-decoration-none text-muted"
                >{% trans "Kundli" %}</a
              >
            </li>
            <li>
              <a
                href="{% url 'horoscope:horoscope_daily' day='today' %}"
                class="text-decoration-none text-muted"
                >{% trans "Horoscope" %}</a
              >
            </li>
            <li>
              <a
                href="javascript:void(0)"
                class="text-decoration-none text-muted"
                >{% trans "Compatibility" %}</a
              >
            </li>
          </ul>
        </div>
        <div>
          <h4>{% trans "Shop" %}</h4>
          <ul>
            <li>
              <a
                href="{% url 'astromall:product_list' %}?category=Gemstones"
                class="text-decoration-none text-muted"
                >{% trans "Gemstones" %}</a
              >
            </li>
            <li>
              <a
                href="{% url 'astromall:product_list' %}?category=Rudraksha"
                class="text-decoration-none text-muted"
                >{% trans "Rudraksha" %}</a
              >
            </li>
          </ul>
        </div>
        <div>
          <h4>{% trans "Contact" %}</h4>
          <ul>
            <li>
              <a
                href="{% url 'astrologers:astrologer_list' %}"
                class="text-decoration-none text-muted"
                >{% trans "24x7 Chat" %}</a
              >
            </li>
            <li>
              <a
                href="mailto:support@pujya.com"
                class="text-decoration-none text-muted"
                >{% trans "Email Support" %}</a
              >
            </li>
          </ul>
        </div>
        <div>
          <h4>{% trans "Secure" %}</h4>
          <ul>
            <li>
              <a
                href="{% url 'astrologers:astrologer_list' %}"
                class="text-decoration-none text-muted"
                >{% trans "Verified Astrologers" %}</a
              >
            </li>
            <li>
              <a
                href="javascript:void(0)"
                class="text-decoration-none text-muted"
                >{% trans "Secure Payments" %}</a
              >
            </li>
            <li>
              <a
                href="{% url 'privacy_policy' %}"
                class="text-decoration-none text-muted"
                >{% trans "Privacy Policy" %}</a
              >
            </li>
            <li>
              <a
                href="{% url 'terms_of_service' %}"
                class="text-decoration-none text-muted"
                >{% trans "Terms of Service" %}</a
              >
            </li>
            <li>
              <a
                href="{% url 'refund_policy' %}"
                class="text-decoration-none text-muted"
                >{% trans "Refund Policy" %}</a
              >
            </li>
          </ul>
        </div>
      </div>
    </footer>

    <div class="copyright">
      &copy; 2025 {% trans "Astrology Platform. All Rights Reserved" %}
    </div>

    <div class="gift">üéÅ {% trans "Claim FREE gift" %}</div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>

    <!-- PWA Service Worker Registration -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("{% static 'js/service-worker.js' %}")
            .then(
              function (registration) {
                console.log(
                  "ServiceWorker registration successful with scope: ",
                  registration.scope
                );
              },
              function (err) {
                console.log("ServiceWorker registration failed: ", err);
              }
            );
        });
      }
    </script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
